<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Telegram WebApp</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
        .container { max-width: 480px; margin: auto; padding: 24px; background: #fff; border-radius: 12px; box-shadow: 0 0 24px #0001; margin-top: 24px; }
        .btn { display: block; width: 100%; margin: 10px 0; padding: 12px; font-size: 1.1em; border: none; border-radius: 8px; background: #007aff; color: #fff; cursor: pointer; }
        .btn.admin { background: #ff9800; }
        .section { margin: 18px 0; }
        .section-title { font-size: 1.2em; margin-bottom: 4px; font-weight: bold; }
        .balance { display: flex; gap: 12px; margin: 8px 0 18px; }
        .history, .purchases { margin-top: 4px; }
        .input { width: 100%; padding: 8px; margin: 6px 0; border-radius: 5px; border: 1px solid #ccc; }
        .modal { display: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; background: #0008; z-index: 10; align-items: center; justify-content: center; }
        .modal-content { background: #fff; padding: 24px; border-radius: 10px; max-width: 340px; width: 90vw; }
        .modal.active { display: flex; }
        .stat-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
        .stat-table th, .stat-table td { border: 1px solid #ccc; padding: 4px 8px; }
        .messages { background: #faf8e9; border-radius: 6px; padding: 8px; margin: 8px 0; }
        .hidden { display: none; }
        .menu-btns { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px;}
        .menu-btns .btn { flex: 1 1 48%; min-width: 130px;}
        .back-btn {background: #999; margin-top: 14px;}
        /* --- admin user list --- */
        .admin-user-list, .admin-requests-list, .admin-manage-list {margin-top:10px;}
        .admin-user-block, .admin-request-block, .admin-manage-block {background:#f6f6f6; border-radius:8px; padding:8px 12px; margin-bottom:8px;}
        .admin-user-block .btn, .admin-request-block .btn, .admin-manage-block .btn {margin:4px 0;}
        .reg-success-message {background: #e8ffe8; color: #277a27; border-radius: 6px; padding: 12px; margin-top: 10px;}
        .reg-error-message {background: #ffe8e8; color: #d32f2f; border-radius: 6px; padding: 12px; margin-top: 10px;}
    </style>
</head>
<body>
<div class="container">

    <!-- –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é -->
    <div id="main-menu">
        <div class="menu-btns">
            <button class="btn" id="user-btn">–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</button>
            <button class="btn admin hidden" id="admin-btn">–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å</button>
        </div>
        <div id="registration-block" class="section">
            <!-- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —Ç—É—Ç -->
        </div>
    </div>

    <!-- –û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ -->
    <div id="user-data" class="hidden">
        <div class="section">
            <div class="section-title">üë§ –û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</div>
            <div>–ö–ª–∏—á–∫–∞: <span id="user-nickname"></span></div>
            <div>–ì–æ–ª–æ–≤–Ω–∏–π –∞–¥–º—ñ–Ω: <span id="main-admin"></span></div>
        </div>
        <div class="section balance">
            <div>–ë–∞–ª–∞–Ω—Å: <span id="balance-main">0</span></div>
            <div>–ë–æ–Ω—É—Å–Ω–∏–π: <span id="balance-bonus">0</span></div>
        </div>

        <div class="menu-btns">
            <button class="btn" id="menu-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="btn" id="menu-withdraw">–ó–Ω—è—Ç—Ç—è</button>
            <button class="btn" id="menu-stat">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="btn" id="menu-auction">–ê—É–∫—Ü—ñ–æ–Ω</button>
            <button class="btn" id="menu-history">–Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–≤–æ–¥—ñ–≤</button>
            <button class="btn" id="menu-purchases">–ü–æ–∫—É–ø–∫–∏</button>
            <button class="btn" id="menu-messages">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
        </div>
        <button class="btn back-btn" id="back-to-main">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω -->
    <div id="shop-section" class="hidden">
        <div class="section">
            <div class="section-title">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
            <select id="shop-items" class="input">
                <option value="">–í–∏–±–µ—Ä–∏ —Ç–æ–≤–∞—Ä</option>
                <option value="1">–¢–æ–≤–∞—Ä 1</option>
                <option value="2">–¢–æ–≤–∞—Ä 2</option>
                <option value="3">–¢–æ–≤–∞—Ä 3</option>
                <option value="4">–¢–æ–≤–∞—Ä 4</option>
                <option value="5">–¢–æ–≤–∞—Ä 5</option>
                <option value="6">–¢–æ–≤–∞—Ä 6</option>
                <option value="7">–¢–æ–≤–∞—Ä 7</option>
                <option value="8">–¢–æ–≤–∞—Ä 8</option>
                <option value="9">–¢–æ–≤–∞—Ä 9</option>
                <option value="10">–¢–æ–≤–∞—Ä 10</option>
            </select>
            <input type="text" id="shop-book" class="input" placeholder="–í–∫–∞–∂–∏ –∫–Ω–∏–≥—É –¥–ª—è –ø–æ–∫—É–ø–∫–∏">
            <button class="btn" id="shop-buy">–ö—É–ø–∏—Ç–∏</button>
        </div>
        <button class="btn back-btn" id="back-user">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –ó–Ω—è—Ç—Ç—è -->
    <div id="withdraw-section" class="hidden">
        <div class="section">
            <div class="section-title">üí∏ –ó–Ω—è—Ç—Ç—è –º–æ–Ω–µ—Ç</div>
            <input type="number" id="withdraw-amount" class="input" min="3000" max="15000" placeholder="–°—É–º–∞ –≤—ñ–¥ 3000 –¥–æ 15000">
            <select id="withdraw-speed" class="input">
                <option value="normal">–ó–≤–∏—á–∞–π–Ω–∏–π –≤–∏–≤—ñ–¥</option>
                <option value="urgent">–¢–µ—Ä–º—ñ–Ω–æ–≤–∏–π –≤–∏–≤—ñ–¥</option>
                <option value="instant">–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π –≤–∏–≤—ñ–¥</option>
            </select>
            <button class="btn" id="withdraw-btn">–í–∏–≤–µ—Å—Ç–∏</button>
        </div>
        <button class="btn back-btn" id="back-user2">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div id="stat-section" class="hidden">
        <div class="section">
            <div class="section-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <input type="text" id="stat-book" class="input" placeholder="–î–æ–¥–∞—Ç–∏ –∫–Ω–∏–≥—É">
            <button class="btn" id="add-stat-book">–î–æ–¥–∞—Ç–∏ –∫–Ω–∏–≥—É</button>
            <div id="stat-books-list"></div>
            <table class="stat-table hidden" id="stat-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ü–µ—Ä–µ–≥–ª—è–¥–∏</th>
                        <th>–î–æ—Ö—ñ–¥</th>
                    </tr>
                </thead>
                <tbody id="stat-table-body"></tbody>
            </table>
        </div>
        <button class="btn back-btn" id="back-user3">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –ê—É–∫—Ü—ñ–æ–Ω -->
    <div id="auction-section" class="hidden">
        <div class="section">
            <div class="section-title">–ê—É–∫—Ü—ñ–æ–Ω</div>
            <div id="auction-block"></div>
        </div>
        <button class="btn back-btn" id="back-user4">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–≤–æ–¥—ñ–≤ -->
    <div id="history-section" class="hidden">
        <div class="section history">
            <div class="section-title">–Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–≤–æ–¥—ñ–≤ (7)</div>
            <ul id="withdraw-history"></ul>
        </div>
        <button class="btn back-btn" id="back-user5">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –ü–æ–∫—É–ø–∫–∏ -->
    <div id="purchases-section" class="hidden">
        <div class="section purchases">
            <div class="section-title">–ü–æ–∫—É–ø–∫–∏ (7)</div>
            <ul id="purchase-history"></ul>
        </div>
        <button class="btn back-btn" id="back-user6">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
    <div id="messages-section" class="hidden">
        <div class="section messages">
            <div class="section-title">–ù–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</div>
            <ul id="user-messages"></ul>
        </div>
        <button class="btn back-btn" id="back-user7">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å -->
    <div id="admin-panel" class="hidden">
        <div class="menu-btns">
            <button class="btn admin" id="show-users">–í—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏</button>
            <button class="btn admin" id="show-requests">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è (–∑–∞—è–≤–∫–∏)</button>
            <button class="btn admin" id="manage-users">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞–º–∏</button>
            <button class="btn admin" id="admin-shop">–ú–∞–≥–∞–∑–∏–Ω (–∑–∞—è–≤–∫–∏)</button>
            <button class="btn admin" id="admin-withdraw">–ó–Ω—è—Ç—Ç—è (–∑–∞—è–≤–∫–∏)</button>
            <button class="btn admin" id="admin-messages">–ù–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
        </div>
        <!-- --- –ê–¥–º—ñ–Ω: –≤—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏ --- -->
        <div class="admin-user-list hidden" id="admin-users-list"></div>
        <!-- --- –ê–¥–º—ñ–Ω: –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é --- -->
        <div class="admin-requests-list hidden" id="admin-requests-list"></div>
        <!-- --- –ê–¥–º—ñ–Ω: —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞–º–∏ --- -->
        <div class="admin-manage-list hidden" id="admin-manage-list"></div>
        <!-- --- –ê–¥–º—ñ–Ω: –º–∞–≥–∞–∑–∏–Ω, –∑–Ω—è—Ç—Ç—è, –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è --- -->
        <div class="admin-shop-list hidden" id="admin-shop-list"></div>
        <div class="admin-withdraw-list hidden" id="admin-withdraw-list"></div>
        <div class="admin-messages-list hidden" id="admin-messages-list"></div>
        <button class="btn back-btn" id="back-to-main-admin">‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>
</div>
<script>
    // --- –í–°–¢–ê–í–õ–Ø–Ñ–ú–û –ü–û–°–ò–õ–ê–ù–ù–Ø –ù–ê –†–ï–ü–õ–Ü–¢-–ë–ï–ö–ï–ù–î ---
    const API_BASE = "https://botproba5.oleg59302a.repl.co";

    // --- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ WebApp ---
    function renderRegistrationForm(userInfo, tg) {
        // –Ø–∫—â–æ –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π ‚Äî –Ω–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É
        if (userInfo.registered) {
            document.getElementById("registration-block").innerHTML = '<div class="reg-success-message">–í–∏ –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ! –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</div>';
            return;
        }
        document.getElementById("registration-block").innerHTML = `
            <h3>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h3>
            <form id="regForm">
                <input type="text" name="nickname" class="input" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ—é –∫–ª–∏—á–∫—É" required>
                <input type="text" name="telegram_login" class="input" placeholder="–í–≤–µ–¥–∏ —Å–≤—ñ–π Telegram (@username)" required>
                <button class="btn" type="submit">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            </form>
            <div id="reg-result"></div>
        `;
        document.getElementById("regForm").onsubmit = async (e) => {
            e.preventDefault();
            let tg_id = tg.id ? tg.id : "";
            let nickname = e.target.nickname.value.trim();
            let telegram_login = e.target.telegram_login.value.trim();
            let res = await fetch(API_BASE + "/api/register", {
                method: "POST",
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    tg_id: tg_id,
                    nickname: nickname,
                    telegram_login: telegram_login
                })
            });
            let json = await res.json();
            if(json.success){
                document.getElementById("reg-result").innerHTML = `<div class="reg-success-message">${json.message}</div>`;
                document.getElementById("regForm").remove();
            } else {
                document.getElementById("reg-result").innerHTML = `<div class="reg-error-message">${json.error}</div>`;
            }
        };
    }

    // --- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ (–º–æ–∫ –¥–ª—è –∞–¥–º—ñ–Ω–∫–∏). –ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ API!
    const demoUsers = [
        {id:1, name:"–Ü–≤–∞–Ω", admin:"–û–ª–µ–≥", balance:5000, bonus:200, books:["–ö–Ω–∏–≥–∞ 1","–ö–Ω–∏–≥–∞ 2"]},
        {id:2, name:"–ú–∞—Ä—ñ—è", admin:"–û–ª–µ–≥", balance:3500, bonus:100, books:["–ö–Ω–∏–≥–∞ 3"]},
        {id:3, name:"–ê—Ä—Ç–µ–º", admin:"–î—ñ–º–∞", balance:9000, bonus:500, books:["–ö–Ω–∏–≥–∞ 4","–ö–Ω–∏–≥–∞ 5"]},
    ];
    const demoRequests = [
        {id:101, name:"–ü–µ—Ç—Ä–æ", telegram:"@petro"},
        {id:102, name:"–û–ª—è", telegram:"@olya"},
    ];
    // --- –í—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏ ---
    function renderAdminUsers() {
        let el = document.getElementById("admin-users-list");
        el.innerHTML = '<h3>–í—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏</h3>' +
            demoUsers.map(u=>`
                <div class="admin-user-block">
                    <b>${u.name}</b> | –ê–¥–º—ñ–Ω: ${u.admin} | –ë–∞–ª–∞–Ω—Å: ${u.balance} | –ë–æ–Ω—É—Å: ${u.bonus}
                    <div>–ö–Ω–∏–≥–∏: ${u.books.join(", ")}</div>
                </div>
            `).join('');
        hideAdminLists();
        el.classList.remove("hidden");
    }
    // --- –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é ---
    function renderAdminRequests() {
        let el = document.getElementById("admin-requests-list");
        el.innerHTML = '<h3>–ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é</h3>' +
            demoRequests.map(r=>`
                <div class="admin-request-block">
                    <b>${r.name}</b> | ${r.telegram}
                    <button class="btn admin" onclick="approveRequest(${r.id})">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                    <button class="btn admin" onclick="declineRequest(${r.id})">–í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
                </div>
            `).join('');
        hideAdminLists();
        el.classList.remove("hidden");
    }
    function approveRequest(id){alert("–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ: "+id);}
    function declineRequest(id){alert("–í—ñ–¥—Ö–∏–ª–µ–Ω–æ: "+id);}
    // --- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞–º–∏ ---
    function renderAdminManage() {
        let el = document.getElementById("admin-manage-list");
        el.innerHTML = '<h3>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞–º–∏</h3>' +
            demoUsers.map(u=>`
                <div class="admin-manage-block">
                    <b>${u.name}</b> | –ê–¥–º—ñ–Ω: ${u.admin}
                    <button class="btn admin" onclick="showUserManage(${u.id})">–ö–µ—Ä—É–≤–∞—Ç–∏</button>
                </div>
            `).join('');
        hideAdminLists();
        el.classList.remove("hidden");
    }
    function showUserManage(id){
        let user = demoUsers.find(u=>u.id===id);
        if(!user) return;
        document.getElementById("admin-manage-list").innerHTML = `
            <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–æ–º: ${user.name}</h3>
            <div>–ë–∞–ª–∞–Ω—Å: <input type="number" value="${user.balance}" id="edit-balance"></div>
            <div>–ë–æ–Ω—É—Å: <input type="number" value="${user.bonus}" id="edit-bonus"></div>
            <div>–ö–Ω–∏–≥–∏: <input type="text" value="${user.books.join(", ")}" id="edit-books"></div>
            <button class="btn admin" onclick="saveUserManage(${user.id})">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            <button class="btn back-btn" onclick="renderAdminManage()">‚¨Ö –ù–∞–∑–∞–¥</button>
        `;
    }
    function saveUserManage(id){
        let user = demoUsers.find(u=>u.id===id);
        if(!user) return;
        user.balance = parseInt(document.getElementById("edit-balance").value);
        user.bonus = parseInt(document.getElementById("edit-bonus").value);
        user.books = document.getElementById("edit-books").value.split(",").map(b=>b.trim());
        alert("–ó–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è "+user.name);
        renderAdminManage();
    }
    // --- –ú–∞–≥–∞–∑–∏–Ω (–∑–∞—è–≤–∫–∏) ---
    function renderAdminShop() {
        let el = document.getElementById("admin-shop-list");
        el.innerHTML = '<h3>–ú–∞–≥–∞–∑–∏–Ω (–∑–∞—è–≤–∫–∏)</h3><div>–¢—É—Ç –±—É–¥—É—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–∫—É–ø–∫–∏ (—Ä–µ–∞–ª—ñ–∑—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –±–µ–∫–µ–Ω–¥)</div>';
        hideAdminLists();
        el.classList.remove("hidden");
    }
    // --- –ó–Ω—è—Ç—Ç—è (–∑–∞—è–≤–∫–∏) ---
    function renderAdminWithdraw() {
        let el = document.getElementById("admin-withdraw-list");
        el.innerHTML = '<h3>–ó–Ω—è—Ç—Ç—è (–∑–∞—è–≤–∫–∏)</h3><div>–¢—É—Ç –±—É–¥—É—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ –∑–Ω—è—Ç—Ç—è (—Ä–µ–∞–ª—ñ–∑—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –±–µ–∫–µ–Ω–¥)</div>';
        hideAdminLists();
        el.classList.remove("hidden");
    }
    // --- –ù–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ---
    function renderAdminMessages() {
        let el = document.getElementById("admin-messages-list");
        el.innerHTML = '<h3>–ù–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h3><div>–¢—É—Ç –±—É–¥—É—Ç—å –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—Ä–µ–∞–ª—ñ–∑—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –±–µ–∫–µ–Ω–¥)</div>';
        hideAdminLists();
        el.classList.remove("hidden");
    }
    function hideAdminLists(){
        ["admin-users-list","admin-requests-list","admin-manage-list","admin-shop-list","admin-withdraw-list","admin-messages-list"]
        .forEach(id=>document.getElementById(id).classList.add("hidden"));
    }

    // --- –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫/—Å–µ–∫—Ü—ñ–π:
    function hideAllSections() {
        ["shop-section","withdraw-section","stat-section","auction-section",
         "history-section","purchases-section","messages-section"]
        .forEach(id=>document.getElementById(id).classList.add("hidden"));
    }

    // –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é
    document.getElementById("user-btn").onclick = () => {
        document.getElementById("main-menu").classList.add("hidden");
        document.getElementById("user-data").classList.remove("hidden");
    };
    document.getElementById("admin-btn").onclick = () => {
        document.getElementById("main-menu").classList.add("hidden");
        document.getElementById("admin-panel").classList.remove("hidden");
        hideAdminLists();
    };
    document.getElementById("back-to-main").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        document.getElementById("main-menu").classList.remove("hidden");
        hideAllSections();
    };
    document.getElementById("back-to-main-admin").onclick = () => {
        document.getElementById("admin-panel").classList.add("hidden");
        document.getElementById("main-menu").classList.remove("hidden");
        hideAdminLists();
    };

    // –û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ ‚Äî –º–µ–Ω—é –∫–Ω–æ–ø–∫–∏
    document.getElementById("menu-shop").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        hideAllSections();
        document.getElementById("shop-section").classList.remove("hidden");
    };
    document.getElementById("menu-withdraw").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        hideAllSections();
        document.getElementById("withdraw-section").classList.remove("hidden");
    };
    document.getElementById("menu-stat").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        hideAllSections();
        document.getElementById("stat-section").classList.remove("hidden");
    };
    document.getElementById("menu-auction").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        hideAllSections();
        document.getElementById("auction-section").classList.remove("hidden");
    };
    document.getElementById("menu-history").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        hideAllSections();
        document.getElementById("history-section").classList.remove("hidden");
    };
    document.getElementById("menu-purchases").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        hideAllSections();
        document.getElementById("purchases-section").classList.remove("hidden");
    };
    document.getElementById("menu-messages").onclick = () => {
        document.getElementById("user-data").classList.add("hidden");
        hideAllSections();
        document.getElementById("messages-section").classList.remove("hidden");
    };

    // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –∑ —Ä–æ–∑–¥—ñ–ª—ñ–≤
    ["back-user","back-user2","back-user3","back-user4","back-user5","back-user6","back-user7"].forEach(id=>{
        document.getElementById(id).onclick = () => {
            hideAllSections();
            document.getElementById("user-data").classList.remove("hidden");
        };
    });

    // --- –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –∫–Ω–æ–ø–∫–∏ ---
    document.getElementById("show-users").onclick = renderAdminUsers;
    document.getElementById("show-requests").onclick = renderAdminRequests;
    document.getElementById("manage-users").onclick = renderAdminManage;
    document.getElementById("admin-shop").onclick = renderAdminShop;
    document.getElementById("admin-withdraw").onclick = renderAdminWithdraw;
    document.getElementById("admin-messages").onclick = renderAdminMessages;

    // --- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∞–¥–º—ñ–Ω–∞ (–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ –∞–¥–º—ñ–Ω–∫—É –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —é–∑–µ—Ä–∞) + —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
    window.onload = async () => {
        // –û—Ç—Ä–∏–º–∞—Ç–∏ Telegram user id —Ç–∞ –¥–∞–Ω—ñ
        let tg = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) || {};
        let tg_id = tg.id || 0;

        // --- –ó–ú–Ü–ù–ï–ù–û: –ó–∞–ø–∏—Ç –¥–æ –±–µ–∫–µ–Ω–¥—É —á–µ—Ä–µ–∑ –ø–æ–≤–Ω–∏–π URL ---
        let userInfo = await fetch(API_BASE + "/api/user-info?tg_id=" + tg_id)
            .then(r => r.json()).catch(()=>({isAdmin:false, registered:false}));

        // –ü–æ–∫–∞–∂–∏ –∫–Ω–æ–ø–∫—É —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –∞–¥–º—ñ–Ω
        if (userInfo.isAdmin) {
            document.getElementById("admin-btn").classList.remove("hidden");
        } else {
            document.getElementById("admin-btn").classList.add("hidden");
        }

        // –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –¥–µ–º–æ-–¥–∞–Ω—ñ —é–∑–µ—Ä–∞ (–∑–∞–ª–∏—à–∞–π —è–∫ –±—É–ª–æ)
        document.getElementById("user-nickname").textContent = userInfo.nickname || tg.first_name || "–ì—ñ—Å—Ç—å";
        document.getElementById("main-admin").textContent = userInfo.admin || "–û–ª–µ–≥";
        document.getElementById("balance-main").textContent = userInfo.balance || "0";
        document.getElementById("balance-bonus").textContent = userInfo.bonus || "0";

        // --- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ WebApp ---
        renderRegistrationForm(userInfo, tg);
    };
</script>
</body>
</html>
